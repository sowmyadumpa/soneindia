(function(e){e.jQTouch=function(t){function b(t){var i={addGlossToIcon:!0,backSelector:".back, .cancel, .goback",cacheGetRequests:!0,cubeSelector:".cube",dissolveSelector:".dissolve",fadeSelector:".fade",fixedViewport:!0,flipSelector:".flip",formSelector:"form",fullScreen:!0,fullScreenClass:"fullscreen",icon:null,touchSelector:"a, .touch",popSelector:".pop",preloadImages:!1,slideSelector:"body > * > ul li a",slideupSelector:".slideup",startupScreen:null,statusBar:"default",submitSelector:".submit",swapSelector:".swap",useAnimations:!0,useFastTouch:!0};o=e.extend({},i,t);if(o.preloadImages)for(var s=o.preloadImages.length-1;s>=0;s--)(new Image).src=o.preloadImages[s];if(o.icon){var u=o.addGlossToIcon?"":"-precomposed";y+='<link rel="apple-touch-icon'+u+'" href="'+o.icon+'" />'}o.startupScreen&&(y+='<link rel="apple-touch-startup-image" href="'+o.startupScreen+'" />'),o.fixedViewport&&(y+='<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"/>'),o.fullScreen&&(y+='<meta name="apple-mobile-web-app-capable" content="yes" />',o.statusBar&&(y+='<meta name="apple-mobile-web-app-status-bar-style" content="'+o.statusBar+'" />')),y&&r.append(y),e(document).ready(function(){for(var t in v){var r=v[t];e.isFunction(r)&&e.extend(d,r(d))}for(var t in m){var i=m[t],s=o[i+"Selector"];typeof s=="string"&&M({name:i,selector:s})}p.push("input"),p.push(o.touchSelector),p.push(o.backSelector),p.push(o.submitSelector),e(p.join(", ")).css("-webkit-touch-callout","none"),e(o.backSelector).tap(x),e(o.submitSelector).tap(O),n=e("body"),o.fullScreenClass&&window.navigator.standalone==1&&n.addClass(o.fullScreenClass+" "+o.statusBar),n.bind("touchstart",D).bind("orientationchange",_).trigger("orientationchange").submit(A),o.useFastTouch&&e.support.touch&&(n.click(function(t){var n=e(t.target);return n.attr("target")=="_blank"||n.attr("rel")=="external"||n.is('input[type="checkbox"]')?!0:!1}),n.mousedown(function(e){var t=(new Date).getTime()-h;if(t<200)return!1})),e("body > .current").length==0?a=e("body > *:first"):(a=e("body > .current:first"),e("body > .current").removeClass("current")),e(a).addClass("current"),location.hash=e(a).attr("id"),T(a),scrollTo(0,0),C()})}function w(e){if(i.length>1){var t=Math.min(parseInt(e||1,10),i.length-1);if(isNaN(t)&&typeof e=="string"&&e!="#")for(var n=1,r=i.length;n<r;n++)if("#"+i[n].id===e){t=n;break}if(isNaN(t)||t<1)t=1;var s=i[0].animation,o=i[0].page;i.splice(0,t);var u=i[0].page;return N(o,u,s,!0),d}return console.error("No pages in history."),!1}function E(t,n){var r=i[0].page;typeof t=="string"&&(t=e(t));if(typeof n=="string")for(var s=g.length-1;s>=0;s--)if(g[s].name===n){n=g[s];break}return N(r,t,n)?(T(t,n),d):(console.error("Could not animate pages."),!1)}function S(){return f}function x(t){var n=e(t.target);n.attr("nodeName")!=="A"&&(n=n.parent("a"));var r=n.attr("target"),i=n.attr("hash"),s=null;if(c==0||!n.length)return console.warn("Not able to tap element."),!1;if(n.attr("target")=="_blank"||n.attr("rel")=="external")return!0;for(var u=g.length-1;u>=0;u--)if(n.is(g[u].selector)){s=g[u];break}return r=="_webapp"?window.location=n.attr("href"):n.is(o.backSelector)?w(i):i&&i!="#"?(n.addClass("active"),E(e(i).data("referrer",n),s)):(n.addClass("loading active"),L(n.attr("href"),{animation:s,callback:function(){n.removeClass("loading"),setTimeout(e.fn.unselect,250,n)},$referrer:n})),!1}function T(e,t){var n=e.attr("id");i.unshift({page:e,animation:t,id:n})}function N(t,n,r,i){if(n.length===0)return e.fn.unselect(),console.error("Target element is missing."),!1;e(":focus").blur(),scrollTo(0,0);var s=function(e){r?(n.removeClass("in reverse "+r.name),t.removeClass("current out reverse "+r.name)):t.removeClass("current"),n.trigger("pageAnimationEnd",{direction:"in"}),t.trigger("pageAnimationEnd",{direction:"out"}),clearInterval(dumbLoop),a=n,location.hash=a.attr("id"),C();var i=n.data("referrer");i&&i.unselect(),h=(new Date).getTime(),c=!0};return t.trigger("pageAnimationStart",{direction:"out"}),n.trigger("pageAnimationStart",{direction:"in"}),e.support.WebKitAnimationEvent&&r&&o.useAnimations?(n.one("webkitAnimationEnd",s),c=!1,n.addClass(r.name+" in current "+(i?" reverse":"")),t.addClass(r.name+" out"+(i?" reverse":""))):(n.addClass("current"),s()),!0}function C(){dumbLoop=setInterval(function(){var e=a.attr("id");if(location.hash=="")location.hash="#"+e;else if(location.hash!="#"+e)try{w(location.hash)}catch(t){console.error("Unknown hash change.")}},100)}function k(t,r){var i=null;return e(t).each(function(t,r){var o=e(this);o.attr("id")||o.attr("id","page-"+ ++s),o.appendTo(n);if(o.hasClass("current")||!i)i=o}),i!==null?(E(i,r),i):!1}function L(t,n){var r={data:null,method:"GET",animation:null,callback:null,$referrer:null},i=e.extend({},r,n);t!="#"?e.ajax({url:t,data:i.data,type:i.method,success:function(e,t){var n=k(e,i.animation);n&&(i.method=="GET"&&o.cacheGetRequests&&i.$referrer&&i.$referrer.attr("href","#"+n.attr("id")),i.callback&&i.callback(!0))},error:function(e){i.$referrer&&i.$referrer.unselect(),i.callback&&i.callback(!1)}}):$referrer&&$referrer.unselect()}function A(t,n){var r=typeof t=="string"?e(t):e(t.target);return r.length&&r.is(o.formSelector)&&r.attr("action")?(L(r.attr("action"),{data:r.serialize(),method:r.attr("method")||"POST",animation:g[0]||null,callback:n}),!1):!0}function O(t){var n=e(this).closest("form");return n.length?(evt=jQuery.Event("submit"),evt.preventDefault(),n.trigger(evt),!1):!0}function M(t){typeof t.selector=="string"&&typeof t.name=="string"&&(g.push(t),e(t.selector).tap(x),p.push(t.selector))}function _(){f=window.innerWidth<window.innerHeight?"profile":"landscape",n.removeClass("profile landscape").addClass(f).trigger("turn",{orientation:f})}function D(t){function c(e){d();var t=Math.abs(a),r=Math.abs(f);t>r&&t>35&&l<1e3?n.trigger("swipe",{direction:a<0?"left":"right"}).unbind("touchmove touchend"):r>1&&n.removeClass("active"),clearTimeout(i)}function h(){d(),f===0&&a===0?(n.makeActive(),n.trigger("tap")):n.removeClass("active"),n.unbind("touchmove touchend"),clearTimeout(i)}function d(){var e=event.changedTouches[0]||null;a=e.pageX-s,f=e.pageY-o,l=(new Date).getTime()-u}var n=e(t.target);if(!e(t.target).is(p.join(", "))){var r=e(t.target).closest("a");if(!r.length)return;n=r}if(event){var i=null,s=event.changedTouches[0].clientX,o=event.changedTouches[0].clientY,u=(new Date).getTime(),a=0,f=0,l=0;n.bind("touchmove",c).bind("touchend",h),i=setTimeout(function(){n.makeActive()},100)}}e.support.WebKitCSSMatrix=typeof WebKitCSSMatrix=="object",e.support.touch=typeof Touch=="object",e.support.WebKitAnimationEvent=typeof WebKitTransitionEvent=="object";var n,r=e("head"),i=[],s=0,o={},u,a,f,l=RegExp(" Mobile/").test(navigator.userAgent),c=!0,h=0,p=[],d={},v=e.jQTouch.prototype.extensions,m=["slide","flip","slideup","swap","cube","pop","dissolve","fade","back"],g=[],y="";return b(t),e.fn.unselect=function(t){t?t.removeClass("active"):e(".active").removeClass("active")},e.fn.makeActive=function(){return e(this).addClass("active")},e.fn.swipe=function(t){if(e.isFunction(t))return this.each(function(n,r){e(r).bind("swipe",t)})},e.fn.tap=function(t){if(e.isFunction(t)){var n=o.useFastTouch&&e.support.touch?"tap":"click";return e(this).live(n,t)}e(this).trigger("tap")},d={getOrientation:S,goBack:w,goTo:E,addAnimation:M,submitForm:A},d},e.jQTouch.prototype.extensions=[],e.jQTouch.addExtension=function(t){e.jQTouch.prototype.extensions.push(t)}})(jQuery);